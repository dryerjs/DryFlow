<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MongoFlow</title>
    <script>
      // DO NOT CHANGE THIS LINE, SERVER WILL INJECT JOBS HERE
      let jobs = [];
    </script>
  </head>
  <body>
    <h1>MongoFlow</h1>
    <p>The best way to move data around your MongoDB databases.</p>
    <form action="">
      <div style="margin-bottom: 10px">
        <label for="source">Source</label>
        <input
          type="text"
          id="source"
          name="source"
          placeholder="Source database"
        />
      </div>
      <div style="margin-bottom: 10px">
        <label for="destination">Destination</label>
        <input
          type="text"
          id="destination"
          name="destination"
          placeholder="Destination database"
        />
      </div>
      <button type="submit">Move data</button>
    </form>
    <br />
    <h2>Jobs</h2>
    <button onclick="refreshJobs();">refresh</button>
    <table>
      <thead>
        <tr>
          <th>Id</th>
          <th>Source</th>
          <th>Destination</th>
          <th>Status</th>
          <th>Progress</th>
        </tr>
      </thead>
      <tbody id="jobs-placeholder"></tbody>
    </table>
  </body>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.3/axios.min.js"
    integrity="sha512-zJXKBryKlsiDaWcWQ9fuvy50SG03/Qc5SqfLXxHmk9XiUUbcD9lXYjHDBxLFOuZSU6ULXaJ69bd7blSMEgxXNQ=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>
  <script>
    function renderJobs() {
      const jobsPlaceholder = document.getElementById('jobs-placeholder');
      jobsPlaceholder.innerHTML = '';
      jobs.forEach((job, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${index + 1}</td>
          <td>${job.source}</td>
          <td>${job.destination}</td>
          <td>${job.status}</td>
          <td>${job.progress}%</td>
        `;
        jobsPlaceholder.appendChild(tr);
      });
    }
    renderJobs();

    function refreshJobs() {
      console.log('refreshing jobs');
      axios.get('/v1/jobs').then(response => {
        jobs = response.data;
        renderJobs();
      });
    }
  </script>
</html>
